\clearpage
\newpage


\section{Results}
\paragraph{Statistical errors}  We used  coalescent simulations of neutral polymorphisms under spatial models of admixture to compare the statistical errors of the AQP and APLS estimates with those of the {\tt tess3} algorithm. The ground truth for the $Q$-matrix (${\bf Q}_0$)  was computed from the mathematical model for admixture proportions used to generate the data. For the $G$-matrix, the  ground truth matrix (${\bf G}_0$) was computed from the empirical genotype frequencies in the two population samples before an admixture event.  The root mean squared errors (RMSE) for the ${\bf Q}$ and ${\bf G}$ estimates decreased as the sample size and the number of loci increased (Figure 1). For all algorithms, the statistical errors were generally small when the number of loci was greater than $10$k SNPs. Those results provided evidence that the three algorithms produced equivalent estimates of the matrices ${\bf Q}_0$ and ${\bf G}_0$. The results also provided a formal check that the APLS and {\tt tess3} algorithms converged to the same estimates as those obtained after the application of  the AQP algorithm, which is guaranteed to converge mathematically.   


\paragraph{The benefit of including spatial information in algorithms}    Using  neutral coalescent simulations of spatial admixture, we compared the statistical estimates obtained from a spatial algorithm (APLS) and a non-spatial algorithm (sNMF, Frichot et al. 2014).  For various levels of ancestral population differentiation, estimates obtained from the spatial algorithm were more accurate than for those obtained using non-spatial approaches (Figure 2). For the larger samples, much finer population structure was detected with the spatial method than with the non-spatial algorithm (Figure 2). 

In simulations of outlier loci, we used the area under the precision-recall curve (AUC) for quantifying the performances of tests based on the estimates of ancestry matrices, {\bf Q} and {\bf G}. In addition, we computed AUCs for $F_{\rm ST}$-based neutrality tests using truly ancestral genotypes. As they represented the maximum reachable values, AUCs based on truly ancestral genotypes were always higher than those obtained for tests based on reconstructed matrices. For all values of the relative  selection intensity, AUCs were higher for spatial methods than for non-spatial methods (Figure 3, the relative selection intensity is the ratio of migration rates at neutral and adaptive loci). For high selection intensities, the performances of tests based on estimates of ancestry matrices were close to the optimal values reached  by tests based on true ancestral frequencies. These results provided evidence that including spatial information in ancestry estimation algorithms improves the detection of signatures of hard selective sweeps having occurred in unknown ancestral populations. 

\paragraph{Runtime and convergence analyses} We subsampled a large SNP data set for {\it A. thaliana} ecotypes  to compare the convergence properties and runtimes of the {\tt tess3}, AQP, and APLS algorithms. In those experiments, we used $K = 6$ ancestral populations, and replicated 5 runs for each simulation. For $n = 100-600$ individuals ($L = 50$k SNPs), the APLS algorithm required more iterations (25 iterations)  than the AQP algorithm (20 iterations) to converge to its solution  (Figure 4). This was less than for {\tt tess3} (30 iterations).  For $L = 10-200$k SNPs ($n = 150$ individuals), similar results were observed. For $50$k SNPs, the runtimes were significantly lower for the APLS algorithm than for the {\tt tess3} and AQP algorithms. For $L = 50$k SNPs and $n = 600$ individuals, it took on average 0.956 min for the APLS and 100 min for the AQP algorithm to compute ancestry estimates. For {\tt tess3}, the runtime was on average 66.3 min. For $L = 100$k SNPs and $n = 150$ individuals, it took on average 0.628 min (8.97 min) for the APLS (AQP) algorithm to compute ancestry estimates. For {\tt tess3}, the runtime was on average 1.27 min.  For those values of $n$ and $L$, the APLS algorithm implementation ran about 2 to 100 times faster than the other algorithm implementations.
 
 
\paragraph{Application to European ecotypes of {\it Arabidopsis  thaliana}} We used  the APLS algorithm to survey spatial population genetic structure and perform a genome scan for adaptive alleles in European ecotypes of the plant species {\it A.  thaliana}. The cross validation criterion decreased rapidly from $K=1$ to $K=3$ clusters,  indicating  that  there were three main ancestral groups in Europe, corresponding to geographic regions in Western Europe, Eastern and Central Europe and Northern Scandinavia. For $K$ greater than four, the values of the cross validation criterion decreased in a slower way, indicating that subtle substructure resulting from complex historical isolation-by-distance  processes could also be detected (Figure 5). The spatial analysis provided an approximate range of  $\sigma = 150$km for the spatial variogram (Figure 5). Figure 6 displays the $Q$-matrix estimate  interpolated on a geographic map of Europe for $K = 6$ ancestral groups. The estimated admixture coefficients provided clear evidence for the clustering of the ecotypes in spatially homogeneous genetic groups. 

\paragraph{Targets of selection in {\it A.  thaliana} genomes}  Tests based on the $F^Q_{\rm ST}$  statistic were applied to the 241k SNP data set to reveal new targets of natural selection in the {\it A. thaliana} genome. {\it A. thaliana} occurs in a broad variety of habitats, and local adaptation to the environment is acknowledged to be important in shaping its genetic diversity through space~\citep{Hancock2011, Fournier-Level2011}. 
The APLS algorithm was run on the 1,095 European lines of {\it A. thaliana} with $K=6$ ancestral populations and $\sigma = 1.5$ for the range parameter. After controlling the FDR at the level $1\%$, the program produced a list of 12,701 candidate SNPs, including linked loci and representing 3\% of the total number of loci. 
 The top 100 candidates included SNPs in the flowering-related genes SHORT VEGETATIVE PHASE (SVP), COP1-interacting protein 4.1 (CIP4.1) and FRIGIDA (FRI) ($p$-values $< 10^{-300}$). These genes were detected by previous scans for selection on this dataset~\citep{Horton2012}.
 We performed a gene ontology enrichment analysis using AmiGO in order to evaluate which biological functions might be involved in local adaptation in Europe. 
 We found a significant over-representation of genes involved in cellular processes (fold enrichment of 1.06, $p$-value equal to 0.0215 after Bonferonni correction).


